<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amazon Sales Dashboard - Complete</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #f5f6fa;
            min-height: 100vh;
        }
        
        .dashboard-layout {
            display: flex;
            height: 100vh;
        }
        
        /* Sidebar */
        .sidebar {
            width: 250px;
            background: #2c3e50;
            color: white;
            transition: width 0.3s ease;
        }
        
        .sidebar.collapsed {
            width: 60px;
        }
        
        .logo {
            padding: 20px;
            background: #1a252f;
            text-align: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .logo h1 {
            font-size: 20px;
            font-weight: 600;
        }
        
        .nav-menu {
            padding: 20px 0;
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: rgba(255,255,255,0.8);
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .nav-item:hover {
            background: rgba(255,255,255,0.1);
            color: white;
        }
        
        .nav-item.active {
            background: #3498db;
            color: white;
        }
        
        .nav-item i {
            width: 24px;
            margin-right: 12px;
            text-align: center;
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        /* Header */
        .header {
            background: white;
            padding: 15px 30px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .toggle-sidebar {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: #333;
        }
        
        .search-box {
            position: relative;
        }
        
        .search-box input {
            padding: 8px 12px 8px 35px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 300px;
        }
        
        .search-box i {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .date-range {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .date-range input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        /* Content Area */
        .content {
            padding: 30px;
            overflow-y: auto;
            flex: 1;
        }
        
        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            position: relative;
            overflow: hidden;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .stat-card.revenue::before {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        
        .stat-card.orders::before {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }
        
        .stat-card.products::before {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
        }
        
        .stat-card.profit::before {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
        }
        
        .stat-label {
            font-size: 14px;
            color: #666;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .stat-value {
            font-size: 28px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }
        
        .stat-change {
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .stat-change.positive {
            color: #10b981;
        }
        
        .stat-change.negative {
            color: #ef4444;
        }
        
        /* Filters */
        .filters-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .filter-group label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: #666;
            margin-bottom: 5px;
        }
        
        .filter-group select,
        .filter-group input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        /* Sales Table */
        .table-section {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .table-header {
            padding: 20px;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .table-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }
        
        .table-actions {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background: #3498db;
            color: white;
        }
        
        .btn-primary:hover {
            background: #2980b9;
        }
        
        .btn-secondary {
            background: #95a5a6;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #7f8c8d;
        }
        
        /* Table Wrapper */
        .table-wrapper {
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        thead {
            background: #f9fafb;
        }
        
        th {
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: #666;
            font-size: 14px;
            border-bottom: 2px solid #e5e7eb;
            white-space: nowrap;
        }
        
        tbody tr {
            border-bottom: 1px solid #e5e7eb;
            transition: background 0.2s ease;
        }
        
        tbody tr:hover {
            background: #f9fafb;
        }
        
        td {
            padding: 12px;
            font-size: 14px;
            color: #333;
        }
        
        /* Product Image in Table */
        .product-cell {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .product-image {
            width: 50px;
            height: 50px;
            object-fit: contain;
            border-radius: 4px;
            background: #f9f9f9;
            padding: 4px;
            border: 1px solid #e5e7eb;
        }
        
        .product-info {
            flex: 1;
        }
        
        .product-name {
            font-weight: 500;
            color: #333;
            margin-bottom: 2px;
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .product-sku {
            font-size: 12px;
            color: #999;
        }
        
        /* Loading */
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Icons (using text symbols) */
        .icon-dashboard::before { content: "üìä"; }
        .icon-sales::before { content: "üí∞"; }
        .icon-products::before { content: "üì¶"; }
        .icon-reports::before { content: "üìà"; }
        .icon-settings::before { content: "‚öôÔ∏è"; }
        .icon-search::before { content: "üîç"; }
        .icon-filter::before { content: "üîΩ"; }
        .icon-export::before { content: "üì•"; }
        
        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                transform: translateX(-100%);
                z-index: 1000;
            }
            
            .sidebar.open {
                transform: translateX(0);
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .filters-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-layout">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="logo">
                <h1>üõçÔ∏è Sales Dashboard</h1>
            </div>
            <nav class="nav-menu">
                <a href="#" class="nav-item active">
                    <i class="icon-dashboard"></i>
                    <span>Dashboard</span>
                </a>
                <a href="#" class="nav-item">
                    <i class="icon-sales"></i>
                    <span>Vendas</span>
                </a>
                <a href="#" class="nav-item">
                    <i class="icon-products"></i>
                    <span>Produtos</span>
                </a>
                <a href="#" class="nav-item">
                    <i class="icon-reports"></i>
                    <span>Relat√≥rios</span>
                </a>
                <a href="#" class="nav-item">
                    <i class="icon-settings"></i>
                    <span>Configura√ß√µes</span>
                </a>
            </nav>
        </aside>
        
        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="header">
                <div class="header-left">
                    <button class="toggle-sidebar" onclick="toggleSidebar()">‚ò∞</button>
                    <div class="search-box">
                        <i class="icon-search"></i>
                        <input type="text" id="globalSearch" placeholder="Buscar produtos...">
                    </div>
                </div>
                <div class="header-right">
                    <div class="date-range">
                        <label style="font-size: 12px; color: #666; margin-right: 5px;">De:</label>
                        <input type="date" id="startDate" onchange="loadSalesData()">
                        <span style="margin: 0 10px;">at√©</span>
                        <label style="font-size: 12px; color: #666; margin-right: 5px;">At√©:</label>
                        <input type="date" id="endDate" onchange="loadSalesData()">
                    </div>
                    <button class="btn btn-primary" onclick="loadSalesData()" style="background: #10b981;">
                        üîç Filtrar
                    </button>
                </div>
            </header>
            
            <!-- Content -->
            <div class="content">
                <!-- Stats Cards -->
                <div class="stats-grid">
                    <div class="stat-card revenue">
                        <div class="stat-label">Receita Total</div>
                        <div class="stat-value" id="totalRevenue">R$ 0,00</div>
                        <div class="stat-change positive">
                            ‚Üë 12.5% vs m√™s anterior
                        </div>
                    </div>
                    <div class="stat-card orders">
                        <div class="stat-label">Total de Pedidos</div>
                        <div class="stat-value" id="totalOrders">0</div>
                        <div class="stat-change positive">
                            ‚Üë 8.3% vs m√™s anterior
                        </div>
                    </div>
                    <div class="stat-card products">
                        <div class="stat-label">Produtos Vendidos</div>
                        <div class="stat-value" id="totalProducts">0</div>
                        <div class="stat-change negative">
                            ‚Üì 2.1% vs m√™s anterior
                        </div>
                    </div>
                    <div class="stat-card profit">
                        <div class="stat-label">Lucro L√≠quido</div>
                        <div class="stat-value" id="netProfit">R$ 0,00</div>
                        <div class="stat-change positive">
                            ‚Üë 15.7% vs m√™s anterior
                        </div>
                    </div>
                </div>
                
                <!-- Filters -->
                <div class="filters-section">
                    <div class="filters-grid">
                        <div class="filter-group">
                            <label>Per√≠odo R√°pido</label>
                            <select id="quickPeriod" onchange="setQuickPeriod()">
                                <option value="">Personalizado</option>
                                <option value="today">Hoje</option>
                                <option value="yesterday">Ontem</option>
                                <option value="last7">√öltimos 7 dias</option>
                                <option value="last30" selected>√öltimos 30 dias</option>
                                <option value="last90">√öltimos 90 dias</option>
                                <option value="thisMonth">Este m√™s</option>
                                <option value="lastMonth">M√™s passado</option>
                                <option value="thisYear">Este ano</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Marketplace</label>
                            <select id="marketplaceFilter">
                                <option value="">Todos</option>
                                <option value="US">Estados Unidos</option>
                                <option value="BR">Brasil</option>
                                <option value="CA">Canad√°</option>
                                <option value="MX">M√©xico</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Categoria</label>
                            <select id="categoryFilter">
                                <option value="">Todas</option>
                                <option value="Electronics">Eletr√¥nicos</option>
                                <option value="Home">Casa</option>
                                <option value="Kitchen">Cozinha</option>
                                <option value="Sports">Esportes</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Ordenar por</label>
                            <select id="sortBy">
                                <option value="revenue">Receita</option>
                                <option value="quantity">Quantidade</option>
                                <option value="profit">Lucro</option>
                                <option value="orders">Pedidos</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- Sales Table -->
                <div class="table-section">
                    <div class="table-header">
                        <h2 class="table-title">Vendas Detalhadas</h2>
                        <div class="table-actions">
                            <button class="btn btn-secondary" onclick="exportToCSV()">
                                <span class="icon-export"></span> Exportar
                            </button>
                            <button class="btn btn-primary" onclick="loadSalesData()">
                                Carregar Dados
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-wrapper">
                        <div id="loading" class="loading" style="display: none;">
                            <div class="spinner"></div>
                            <p>Carregando dados...</p>
                        </div>
                        
                        <table id="salesTable" style="display: none;">
                            <thead>
                                <tr>
                                    <th>Produto</th>
                                    <th>ASIN</th>
                                    <th>SKU</th>
                                    <th>Pre√ßo M√©dio</th>
                                    <th>Qtd Vendida</th>
                                    <th>Pedidos</th>
                                    <th>Receita Total</th>
                                    <th>Custo Total</th>
                                    <th>Lucro Total</th>
                                    <th>Margem %</th>
                                </tr>
                            </thead>
                            <tbody id="salesTableBody">
                                <!-- Data will be inserted here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <script>
        let salesData = [];
        
        // Toggle sidebar
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('collapsed');
        }
        
        // Format currency
        function formatCurrency(value) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            }).format(value || 0);
        }
        
        // Set quick period dates
        function setQuickPeriod() {
            const period = document.getElementById('quickPeriod').value;
            const startDateInput = document.getElementById('startDate');
            const endDateInput = document.getElementById('endDate');
            const today = new Date();
            let startDate = new Date();
            let endDate = new Date();
            
            switch(period) {
                case 'today':
                    startDate = today;
                    endDate = today;
                    break;
                case 'yesterday':
                    startDate = new Date(today.getTime() - 24 * 60 * 60 * 1000);
                    endDate = new Date(today.getTime() - 24 * 60 * 60 * 1000);
                    break;
                case 'last7':
                    startDate = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
                    endDate = today;
                    break;
                case 'last30':
                    startDate = new Date(today.getTime() - 30 * 24 * 60 * 60 * 1000);
                    endDate = today;
                    break;
                case 'last90':
                    startDate = new Date(today.getTime() - 90 * 24 * 60 * 60 * 1000);
                    endDate = today;
                    break;
                case 'thisMonth':
                    startDate = new Date(today.getFullYear(), today.getMonth(), 1);
                    endDate = today;
                    break;
                case 'lastMonth':
                    startDate = new Date(today.getFullYear(), today.getMonth() - 1, 1);
                    endDate = new Date(today.getFullYear(), today.getMonth(), 0);
                    break;
                case 'thisYear':
                    startDate = new Date(today.getFullYear(), 0, 1);
                    endDate = today;
                    break;
                default:
                    return; // Custom period, don't change dates
            }
            
            startDateInput.value = startDate.toISOString().split('T')[0];
            endDateInput.value = endDate.toISOString().split('T')[0];
            
            // Reload data with new dates
            loadSalesData();
        }
        
        // Format percentage
        function formatPercentage(value) {
            return `${(value * 100).toFixed(1)}%`;
        }
        
        // Load sales data
        async function loadSalesData() {
            const loading = document.getElementById('loading');
            const table = document.getElementById('salesTable');
            
            loading.style.display = 'block';
            table.style.display = 'none';
            
            // Get date filters
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            
            try {
                // Query for aggregated sales data by ASIN with product images and date filter
                const query = `
                    SELECT 
                        oi.asin,
                        MAX(oi.seller_sku) as sku,
                        MAX(oi.title) as product_name,
                        MAX(p.image_url) as image_url,
                        AVG(COALESCE(oi.item_price, 0)) as price,
                        SUM(oi.quantity_ordered) as quantity,
                        COUNT(DISTINCT oi.amazon_order_id) as order_count,
                        SUM(COALESCE(oi.item_price, 0) * COALESCE(oi.quantity_ordered, 0)) as revenue,
                        SUM(COALESCE(oi.item_price, 0) * COALESCE(oi.quantity_ordered, 0) * 0.7) as cost,
                        SUM(COALESCE(oi.item_price, 0) * COALESCE(oi.quantity_ordered, 0) * 0.3) as profit,
                        CASE 
                            WHEN SUM(COALESCE(oi.item_price, 0) * COALESCE(oi.quantity_ordered, 0)) > 0 
                            THEN ROUND((SUM(COALESCE(oi.item_price, 0) * COALESCE(oi.quantity_ordered, 0) * 0.3) / 
                                 SUM(COALESCE(oi.item_price, 0) * COALESCE(oi.quantity_ordered, 0)) * 100)::numeric, 2)
                            ELSE 0 
                        END as margin_percent,
                        MIN(o.purchase_date) as first_sale,
                        MAX(o.purchase_date) as last_sale
                    FROM order_items oi
                    LEFT JOIN products p ON p.asin = oi.asin
                    LEFT JOIN orders o ON o.amazon_order_id = oi.amazon_order_id
                    WHERE oi.asin IS NOT NULL
                    ${startDate ? `AND o.purchase_date >= '${startDate}'::date` : ''}
                    ${endDate ? `AND o.purchase_date <= '${endDate}'::date + interval '1 day'` : ''}
                    GROUP BY oi.asin
                    HAVING SUM(oi.quantity_ordered) > 0
                    ORDER BY SUM(COALESCE(oi.item_price, 0) * COALESCE(oi.quantity_ordered, 0)) DESC NULLS LAST
                    LIMIT 50
                `;
                
                const response = await fetch('http://localhost:8086/api/ai-query/execute', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ sql: query })
                });
                
                const result = await response.json();
                
                if (result.data) {
                    salesData = result.data;
                    renderTable(salesData);
                    updateStats(salesData);
                } else if (result.error) {
                    throw new Error(result.message || result.error);
                }
                
            } catch (error) {
                console.error('Error loading sales data:', error);
                alert('Erro ao carregar dados. Verifique se o servidor est√° rodando.');
            } finally {
                loading.style.display = 'none';
                table.style.display = 'table';
            }
        }
        
        // Render table
        function renderTable(data) {
            const tbody = document.getElementById('salesTableBody');
            tbody.innerHTML = '';
            
            data.forEach(item => {
                // Handle image URL
                let imageSrc = '';
                if (item.image_url) {
                    if (item.image_url.startsWith('/product-images/')) {
                        imageSrc = `http://localhost:8086${item.image_url}`;
                    } else if (item.image_url.includes('localhost')) {
                        imageSrc = item.image_url;
                    } else if (item.image_url.includes('amazon.com')) {
                        imageSrc = `http://localhost:8086/api/image-proxy?url=${encodeURIComponent(item.image_url)}`;
                    } else {
                        imageSrc = item.image_url;
                    }
                }
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <div class="product-cell">
                            ${imageSrc ? 
                                `<img src="${imageSrc}" 
                                     alt="${item.product_name}" 
                                     class="product-image"
                                     onerror="this.style.display='none'">` 
                                : ''}
                            <div class="product-info">
                                <div class="product-name">${item.product_name || 'Produto sem nome'}</div>
                                <div class="product-sku">SKU: ${item.sku || 'N/A'}</div>
                            </div>
                        </div>
                    </td>
                    <td>${item.asin}</td>
                    <td>${item.sku || 'N/A'}</td>
                    <td>${formatCurrency(item.price)}</td>
                    <td style="text-align: center; font-weight: bold;">${item.quantity || 0}</td>
                    <td style="text-align: center;">${item.order_count || 0}</td>
                    <td style="color: #10b981; font-weight: bold;">${formatCurrency(item.revenue)}</td>
                    <td>${formatCurrency(item.cost)}</td>
                    <td style="color: #3498db; font-weight: bold;">${formatCurrency(item.profit)}</td>
                    <td style="text-align: center;">
                        <span style="padding: 4px 8px; background: ${item.margin_percent > 20 ? '#10b98120' : '#ef444420'}; border-radius: 4px;">
                            ${item.margin_percent || 0}%
                        </span>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // Update statistics
        function updateStats(data) {
            const totalRevenue = data.reduce((sum, item) => sum + (item.revenue || 0), 0);
            const totalOrders = data.filter(item => item.quantity > 0).length;
            const totalProducts = data.reduce((sum, item) => sum + (item.quantity || 0), 0);
            const netProfit = data.reduce((sum, item) => sum + (item.profit || 0), 0);
            
            document.getElementById('totalRevenue').textContent = formatCurrency(totalRevenue);
            document.getElementById('totalOrders').textContent = totalOrders;
            document.getElementById('totalProducts').textContent = totalProducts;
            document.getElementById('netProfit').textContent = formatCurrency(netProfit);
        }
        
        // Export to CSV
        function exportToCSV() {
            if (salesData.length === 0) {
                alert('Nenhum dado para exportar');
                return;
            }
            
            const headers = ['ASIN', 'SKU', 'Produto', 'Pre√ßo', 'Quantidade', 'Receita', 'Custo', 'Lucro', 'Status'];
            const rows = salesData.map(item => [
                item.asin,
                item.sku || '',
                item.product_name || '',
                item.price || 0,
                item.quantity || 0,
                item.revenue || 0,
                item.cost || 0,
                item.profit || 0,
                item.status || ''
            ]);
            
            let csv = headers.join(',') + '\n';
            rows.forEach(row => {
                csv += row.map(cell => `"${cell}"`).join(',') + '\n';
            });
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `sales_report_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
        }
        
        // Search functionality
        document.getElementById('globalSearch').addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            const filtered = salesData.filter(item => 
                item.product_name?.toLowerCase().includes(searchTerm) ||
                item.asin?.toLowerCase().includes(searchTerm) ||
                item.sku?.toLowerCase().includes(searchTerm)
            );
            renderTable(filtered);
        });
        
        // Filter functionality
        document.getElementById('sortBy').addEventListener('change', (e) => {
            const sortBy = e.target.value;
            const sorted = [...salesData].sort((a, b) => {
                switch(sortBy) {
                    case 'revenue': return (b.revenue || 0) - (a.revenue || 0);
                    case 'quantity': return (b.quantity || 0) - (a.quantity || 0);
                    case 'profit': return (b.profit || 0) - (a.profit || 0);
                    case 'orders': return (b.order_count || 0) - (a.order_count || 0);
                    default: return 0;
                }
            });
            renderTable(sorted);
        });
        
        // Initialize with last 30 days on page load
        window.addEventListener('DOMContentLoaded', () => {
            // Set default period to last 30 days
            setQuickPeriod();
        });
    </script>
</body>
</html>